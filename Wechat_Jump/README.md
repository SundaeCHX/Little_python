# Wechat_Jump

微信“跳一跳” IOS设备+Windows+树莓派 模拟程序

将IOS设备连接至电脑，利用iTools软件中的AirPlay功能可将设备屏幕投影至电脑桌面，调节 jump.py 文件中的参数设置截屏范围截取投影用于图像处理。

手动截取游戏运行画面中的棋子、白点、音乐播放器等图像，分别存储为 "chess.png"、"not.png"、"music.png"等图片，
与 jump.py 放在同一目录下，用于图像处理中的模板匹配。

在树莓派端运行 python control.py 程序会等待 PC 发送的距离指令，控制舵机运行，模拟手指按压屏幕。
舵机运行角度，距离与按压时间的系数需根据情况调整。

在 Windows 端运行 python3 jump.py 程序会开始进行图像处理，计算棋子坐标和目标落点，将计算出的距离发送给树莓派，同时会将处理后的图像保存以用于后期调试。

## 算法详解

1、读取截屏得到的游戏画面并作灰度化处理

2、读取棋子图片与游戏画面进行模板匹配，确定棋子位置，标定棋子中心坐标

3、若棋子跳跃后落在方块的中心点，则下一方块中心会出现白点，对白点进行模板匹配，标定白点中心坐标作为目标落点

4、若没有匹配到白点，则对灰度图像做高斯滤波处理后进行边缘检测，得到 Canny 图像

5、由于下一个方块上沿总是在最上方，且矩形块上沿是一个点，圆形块上沿是一条直线，
因此从上到下扫描 Canny 图像，得到的第一个具有数值的点即为方块的上沿顶点（圆形块会得到若干点，此时取点的 X 坐标平均值即可），
由此可确定方块中心所在的直线，即目标落点的 x 坐标已确定

6、沿方块的中心直线从上顶点向下扫描，遇到的第一个点即为方块的下端点，求两点 y 坐标的平均值，即目标落点的 y 坐标已确定

7、以上已得到棋子中心坐标和目标落点的坐标，可求出两点间的直线距离，即为跳跃距离
